import{j as g}from"../../../_chunks/chunk-LNJVEJI5.js";import{c as u,f as l,g as p,i as h}from"../../../_chunks/chunk-THKE7DQS.js";var c=l(h(),1);var a=l(h(),1),e=l(h(),1);var o=class extends a.EntityGrid{constructor(t){super(t);this.element.on("keyup."+this.uniqueName+" change."+this.uniqueName,"input.custom-text",r=>{var i=(0,e.trimToNull)((0,a.Fluent)(r.target).val());i===""&&(i=null),this.view.getItemById((0,a.Fluent)(r.target).data("key")).CustomText=i,this.hasChanges=!0})}getIdProperty(){return"Key"}getLocalTextPrefix(){return"Administration.Translation"}getService(){return g.baseUrl}onClick(t,r,i){var m;if(super.onClick(t,r,i),t.defaultPrevented||(m=t==null?void 0:t.isDefaultPrevented)!=null&&m.call(t))return;let s=this.itemAt(r),n;if((0,a.Fluent)(t.target).hasClass("source-text")){if(t.preventDefault(),n=u(()=>{s.CustomText=s.SourceText,this.view.updateItem(s.Key,s),this.hasChanges=!0},"done"),(0,e.isTrimmedEmpty)(s.CustomText)||(0,e.trimToEmpty)(s.CustomText)===(0,e.trimToEmpty)(s.SourceText)){n();return}(0,e.confirm)((0,e.localText)("Db.Administration.Translation.OverrideConfirmation"),n);return}if((0,a.Fluent)(t.target).hasClass("target-text")){if(t.preventDefault(),n=u(()=>{s.CustomText=s.TargetText,this.view.updateItem(s.Key,s),this.hasChanges=!0},"done"),(0,e.isTrimmedEmpty)(s.CustomText)||(0,e.trimToEmpty)(s.CustomText)===(0,e.trimToEmpty)(s.TargetText)){n();return}(0,e.confirm)((0,e.localText)("Db.Administration.Translation.OverrideConfirmation"),n);return}}getColumns(){var t=[];return t.push({field:"Key",width:300,sortable:!1}),t.push({field:"SourceText",width:300,sortable:!1,format:r=>(0,e.outerHtml)((0,a.Fluent)("a").addClass("source-text").text(r.value||""))}),t.push({field:"CustomText",width:300,sortable:!1,format:r=>(0,e.outerHtml)((0,a.Fluent)("input").addClass("custom-text").attr("value",r.value).attr("type","text").attr("data-key",r.item.Key))}),t.push({field:"TargetText",width:300,sortable:!1,format:r=>(0,e.outerHtml)((0,a.Fluent)("a").addClass("target-text").text(r.value||""))}),t}createToolbarExtensions(){super.createToolbarExtensions();let t={lookupKey:"Administration.Language"};this.sourceLanguage=a.Widget.create({type:a.LookupEditor,element:r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+(0,e.localText)("Db.Administration.Translation.SourceLanguage")+" ---"),options:t}),this.sourceLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()}),this.targetLanguage=a.Widget.create({type:a.LookupEditor,element:r=>r.appendTo(this.toolbar.element).attr("placeholder","--- "+(0,e.localText)("Db.Administration.Translation.TargetLanguage")+" ---"),options:t}),this.targetLanguage.changeSelect2(r=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()})}saveChanges(t){var r={};for(let i of this.getItems())r[i.Key]=i.CustomText;return Promise.resolve(g.Update({TargetLanguageID:t,Translations:r})).then(()=>{this.hasChanges=!1,t=(0,e.trimToNull)(t)||"invariant",(0,e.notifySuccess)('User translations in "'+t+'" language are saved to "user.texts.'+t+'.json" file under "~/App_Data/texts/"',"")})}onViewSubmit(){var t=this.view.params;return t.SourceLanguageID=this.sourceLanguage.value,this.targetLanguageKey=this.targetLanguage.value||"",t.TargetLanguageID=this.targetLanguageKey,this.hasChanges=!1,super.onViewSubmit()}getButtons(){return[{title:(0,e.localText)("Db.Administration.Translation.SaveChangesButton"),onClick:t=>this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()),cssClass:"apply-changes-button"}]}createQuickSearchInput(){a.GridUtils.addQuickSearchInputCustom(this.toolbar.element,(t,r)=>{this.searchText=r,this.view.setItems(this.view.getItems(),!0)})}onViewFilter(t){if(!super.onViewFilter(t))return!1;if(!this.searchText)return!0;var r=Select2.util.stripDiacritics,i=r(this.searchText).toLowerCase();function s(n){return n?n.toLowerCase().indexOf(i)>=0:!1}return u(s,"match"),(0,e.isEmptyOrNull)(i)||s(t.Key)||s(t.SourceText)||s(t.TargetText)||s(t.CustomText)}usePager(){return!1}};u(o,"TranslationGrid"),o=p([a.Decorators.registerClass()],o);var b=u(()=>(0,c.gridPageInit)(o),"default");export{b as default};
//# sourceMappingURL=TranslationPage.js.map
